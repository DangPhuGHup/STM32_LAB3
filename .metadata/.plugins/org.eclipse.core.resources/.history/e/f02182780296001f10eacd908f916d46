/*
 * fsm_automatic.c
 *
 *  Created on: Oct 28, 2024
 *      Author: Admin
 */
#include "fsm_automatic.h"

void fsm_automatic_Run(){
	switch(status){
		    case INIT:
		    	HAL_GPIO_WritePin(LED_RED_GPIO_Port, LED_RED_Pin, GPIO_PIN_SET);
		    	HAL_GPIO_WritePin(LED_GREEN_GPIO_Port, LED_GREEN_Pin, GPIO_PIN_SET);
		    	HAL_GPIO_WritePin(LED_YELLOW_GPIO_Port, LED_YELLOW_Pin, GPIO_PIN_SET);
		    	status = AUTO_RED;
		    	setTimer(500);
		    	break;
		    case AUTO_RED:
		    	HAL_GPIO_WritePin(LED_RED_GPIO_Port, LED_RED_Pin, GPIO_PIN_RESET);
		        HAL_GPIO_WritePin(LED_GREEN_GPIO_Port, LED_GREEN_Pin, GPIO_PIN_SET);
		    	HAL_GPIO_WritePin(LED_YELLOW_GPIO_Port, LED_YELLOW_Pin, GPIO_PIN_SET);
		    	if(timer_flag == 1)
		    	{
		    		setTimer(300);
		    		status = AUTO_GREEN;
		    	}
		    	if(timer1_flag == 1)
		    	{
		    		timer1_flag = 0;
		    		setTimer(800);      // neu khong nhan gi nua, 8s sau quay ve trang thai auto.
		    		status = MAN_RED;
		    	}
		    	break;
		    case AUTO_GREEN:
		    	HAL_GPIO_WritePin(LED_RED_GPIO_Port, LED_RED_Pin, GPIO_PIN_SET);
		    	HAL_GPIO_WritePin(LED_GREEN_GPIO_Port, LED_GREEN_Pin, GPIO_PIN_RESET);
		    	HAL_GPIO_WritePin(LED_YELLOW_GPIO_Port, LED_YELLOW_Pin, GPIO_PIN_SET);
		    	if(timer_flag == 1)
		    	{
		    		setTimer(200);
		    		status = AUTO_YELLOW;
		    	}
		    	if(timer1_flag == 1)
				{
					timer1_flag = 0;
					setTimer(800);
					status = MAN_GREEN;
				}
		    	break;
		    case AUTO_YELLOW:
		    	HAL_GPIO_WritePin(LED_RED_GPIO_Port, LED_RED_Pin, GPIO_PIN_SET);
		    	HAL_GPIO_WritePin(LED_GREEN_GPIO_Port, LED_GREEN_Pin, GPIO_PIN_SET);
		    	HAL_GPIO_WritePin(LED_YELLOW_GPIO_Port, LED_YELLOW_Pin, GPIO_PIN_RESET);
		        if(timer_flag == 1)
		        {
		    		setTimer(500);
		    		status = AUTO_RED;
		    	}
		        if(timer1_flag == 1)
				{
					timer1_flag = 0;
					setTimer(800);
					status = MAN_YELLOW;
				}
		    	break;
		    default:
		    	break;
		}
}
